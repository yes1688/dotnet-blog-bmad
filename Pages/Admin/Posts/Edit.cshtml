@page "{id:int}"
@model dotnet_blog_bmad.Pages.Admin.Posts.EditModel

@{
    ViewData["Title"] = "編輯文章";
    Layout = "/Pages/Admin/_AdminLayout.cshtml";
}

<div class="container mx-auto px-4 py-8">
    <div class="max-w-4xl mx-auto">
        <div class="bg-white rounded-lg shadow-md p-6">
            <h1 class="text-3xl font-bold mb-6 text-gray-800">編輯文章</h1>

            <form method="post">
                <input type="hidden" asp-for="Id" />

                <div class="mb-6">
                    <label asp-for="Title" class="block text-sm font-medium text-gray-700 mb-2">標題</label>
                    <input asp-for="Title" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" />
                    <span asp-validation-for="Title" class="text-red-500 text-sm mt-1"></span>
                </div>

                <div class="mb-6">
                    <label asp-for="Summary" class="block text-sm font-medium text-gray-700 mb-2">摘要</label>
                    <textarea asp-for="Summary" rows="3" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"></textarea>
                    <span asp-validation-for="Summary" class="text-red-500 text-sm mt-1"></span>
                </div>

                <div class="mb-6">
                    <label asp-for="Content" class="block text-sm font-medium text-gray-700 mb-2">內容 (Markdown)</label>
                    <textarea asp-for="Content" rows="15" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent font-mono text-sm"></textarea>
                    <span asp-validation-for="Content" class="text-red-500 text-sm mt-1"></span>
                </div>

                <!-- 標籤 -->
                <div class="mb-6">
                    <label asp-for="TagInput" class="block text-sm font-medium text-gray-700 mb-2">
                        標籤
                    </label>
                    <input asp-for="TagInput"
                           type="text"
                           class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                           placeholder="輸入標籤，以逗號分隔 (例如: C#, ASP.NET, 程式設計)" />
                    <p class="mt-1 text-sm text-gray-500">
                        輸入多個標籤時請用逗號分隔
                    </p>
                    <span asp-validation-for="TagInput" class="text-red-600 text-sm"></span>
                </div>

                <div class="mb-6">
                    <label class="flex items-center">
                        <input asp-for="IsPublished" type="checkbox" class="w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-2 focus:ring-blue-500" />
                        <span class="ml-2 text-sm font-medium text-gray-700">發布文章</span>
                    </label>
                    <span asp-validation-for="IsPublished" class="text-red-500 text-sm mt-1"></span>
                </div>

                <div class="flex gap-4">
                    <button type="submit" class="px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition-colors">
                        儲存變更
                    </button>
                    <a href="/Admin/Posts/Index" class="px-6 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 focus:outline-none focus:ring-2 focus:ring-gray-500 focus:ring-offset-2 transition-colors">
                        取消
                    </a>
                </div>
            </form>
        </div>
    </div>
</div>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/easymde/dist/easymde.min.css">
    <script src="https://cdn.jsdelivr.net/npm/easymde/dist/easymde.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script>
        var easyMDE = new EasyMDE({
            element: document.getElementById('Content'),
            spellChecker: false,
            autosave: {
                enabled: true,
                uniqueId: "edit-post-content-@Model.Id",
                delay: 1000,
            },
            placeholder: "在此輸入 Markdown 格式的文章內容...",
            toolbar: ["bold", "italic", "heading", "|", "quote", "unordered-list", "ordered-list", "|", "link", "image", "|", "preview", "side-by-side", "fullscreen", "|", "guide"],
            previewRender: function(plainText) {
                return marked.parse(plainText);
            }
        });
    </script>
}
